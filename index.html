<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SleepCycle Mate</title>
    
    <!-- PWA / Mobile Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    
    <!-- App Icons: Minimal Crescent Moon (White on Dark logic handles by OS mostly, but here using a clean PNG) -->
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1823/1823324.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1823/1823324.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href='data:application/manifest+json,{"name": "SleepCycle Mate", "short_name": "SleepCycle", "start_url": ".", "display": "standalone", "background_color": "#0f172a", "theme_color": "#0f172a", "icons": [{"src": "https://cdn-icons-png.flaticon.com/512/1823/1823324.png", "sizes": "512x512", "type": "image/png"}]}'>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }

        /* Seamless Animations */
        .smooth-transition {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fade-enter {
            opacity: 0;
            transform: translateY(10px) scale(0.98);
        }
        .fade-enter-active {
            opacity: 1;
            transform: translateY(0) scale(1);
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Glassmorphism Refined */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Animated Blob tweaks for smoother breathing */
        @keyframes blob-float {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob-smooth {
            animation: blob-float 10s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }

        /* Custom Input styling to remove default clock icon in some browsers */
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        input[type="time"]::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const MoonIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
        );
        const BedIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></svg>
        );
        const ClockIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        );
        const ChevronLeft = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m15 18-6-6 6-6"/></svg>
        );

        // --- Logic ---
        const SLEEP_CYCLE = 90; 
        const FALL_ASLEEP_TIME = 15;

        const formatTime = (date) => {
            let hours = date.getHours();
            let minutes = date.getMinutes();
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        };

        const addMinutes = (date, minutes) => {
            return new Date(date.getTime() + minutes * 60000);
        };

        // --- Components ---
        const App = () => {
            const [mode, setMode] = useState('wakeup'); 
            const [inputTime, setInputTime] = useState(formatTime(new Date()));
            const [results, setResults] = useState([]);
            const [view, setView] = useState('input'); // 'input' or 'results'
            const [isOffline, setIsOffline] = useState(!navigator.onLine);
            const [animateKey, setAnimateKey] = useState(0); // To trigger re-animations

            useEffect(() => {
                const handleOnlineStatus = () => setIsOffline(!navigator.onLine);
                window.addEventListener('online', handleOnlineStatus);
                window.addEventListener('offline', handleOnlineStatus);

                if (mode === 'bedtime' && view === 'input') {
                    const timer = setInterval(() => {
                        setInputTime(formatTime(new Date()));
                    }, 1000 * 60);
                    return () => {
                        clearInterval(timer);
                        window.removeEventListener('online', handleOnlineStatus);
                        window.removeEventListener('offline', handleOnlineStatus);
                    };
                }
                return () => {
                    window.removeEventListener('online', handleOnlineStatus);
                    window.removeEventListener('offline', handleOnlineStatus);
                }
            }, [mode, view]);

            const calculateTimes = () => {
                const now = new Date();
                const [hours, minutes] = inputTime.split(':').map(Number);
                let baseTime = new Date();
                baseTime.setHours(hours);
                baseTime.setMinutes(minutes);
                baseTime.setSeconds(0);

                if (mode === 'wakeup' && baseTime < now) {
                    baseTime.setDate(baseTime.getDate() + 1);
                }

                let cycles = [];
                const cycleCounts = [6, 5, 4, 3]; 

                cycleCounts.forEach(cycleCount => {
                    let calculatedTime;
                    let duration;

                    if (mode === 'bedtime') {
                        duration = FALL_ASLEEP_TIME + (cycleCount * SLEEP_CYCLE);
                        calculatedTime = addMinutes(baseTime, duration);
                    } else {
                        duration = (cycleCount * SLEEP_CYCLE) + FALL_ASLEEP_TIME;
                        calculatedTime = addMinutes(baseTime, -duration);
                    }

                    cycles.push({
                        cycles: cycleCount,
                        time: formatTime(calculatedTime),
                        fullDate: calculatedTime,
                        hoursDetails: (cycleCount * 1.5).toFixed(1)
                    });
                });

                cycles.sort((a, b) => a.fullDate - b.fullDate);
                setResults(cycles);
                
                // Trigger transition
                setAnimateKey(prev => prev + 1);
                setView('results');
            };

            const reset = () => {
                setAnimateKey(prev => prev + 1);
                setView('input');
                if (mode === 'bedtime') setInputTime(formatTime(new Date()));
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden select-none bg-slate-900">
                    
                    {/* Seamless Background Blobs */}
                    <div className="fixed inset-0 overflow-hidden pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-indigo-600/20 rounded-full mix-blend-screen filter blur-3xl animate-blob-smooth"></div>
                        <div className="absolute top-[20%] right-[-20%] w-[400px] h-[400px] bg-purple-600/20 rounded-full mix-blend-screen filter blur-3xl animate-blob-smooth animation-delay-2000"></div>
                        <div className="absolute bottom-[-20%] left-[20%] w-[600px] h-[600px] bg-blue-600/10 rounded-full mix-blend-screen filter blur-3xl animate-blob-smooth animation-delay-4000"></div>
                    </div>

                    {/* Main Card */}
                    <div className="z-10 w-full max-w-md glass-panel rounded-[2rem] p-6 sm:p-8 smooth-transition relative">
                        
                        {/* Header - Always visible but adaptable */}
                        <div className={`text-center smooth-transition ${view === 'results' ? 'mb-6 scale-90 origin-top' : 'mb-10 scale-100'}`}>
                            <h1 className="text-3xl font-bold bg-gradient-to-r from-indigo-200 to-purple-200 bg-clip-text text-transparent flex items-center justify-center gap-3">
                                <MoonIcon className="text-indigo-300 drop-shadow-lg" /> 
                                <span className="tracking-tight">SleepCycle</span>
                            </h1>
                            <div className={`overflow-hidden transition-all duration-500 ${view === 'results' ? 'max-h-0 opacity-0' : 'max-h-10 opacity-100'}`}>
                                <p className="text-slate-400 text-sm mt-2 font-light">
                                    นอนหลับอย่างมีคุณภาพ ตื่นมาสดใส
                                </p>
                            </div>
                        </div>

                        {/* Content Switcher */}
                        <div className="relative overflow-hidden min-h-[300px]">
                            
                            {/* Input View */}
                            <div className={`absolute inset-0 w-full transition-all duration-500 ease-in-out transform 
                                ${view === 'input' ? 'opacity-100 translate-x-0' : 'opacity-0 -translate-x-full pointer-events-none'}`}>
                                
                                {/* Toggle Tabs */}
                                <div className="grid grid-cols-2 gap-2 bg-slate-900/40 p-1.5 rounded-2xl mb-8 border border-slate-700/30">
                                    <button 
                                        onClick={() => setMode('wakeup')}
                                        className={`py-3 px-4 rounded-xl text-sm font-medium smooth-transition flex items-center justify-center gap-2
                                            ${mode === 'wakeup' ? 'bg-indigo-600/90 text-white shadow-lg shadow-indigo-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/30'}`}
                                    >
                                        <ClockIcon size={18} /> จะตื่นกี่โมง
                                    </button>
                                    <button 
                                        onClick={() => { setMode('bedtime'); setInputTime(formatTime(new Date())); }}
                                        className={`py-3 px-4 rounded-xl text-sm font-medium smooth-transition flex items-center justify-center gap-2
                                            ${mode === 'bedtime' ? 'bg-indigo-600/90 text-white shadow-lg shadow-indigo-500/20' : 'text-slate-400 hover:text-slate-200 hover:bg-slate-800/30'}`}
                                    >
                                        <BedIcon size={18} /> จะนอนตอนนี้
                                    </button>
                                </div>

                                {/* Time Input */}
                                <div className="text-center mb-8">
                                    <label className="block text-slate-400 text-sm mb-4 font-light tracking-wide">
                                        {mode === 'wakeup' ? 'ตั้งเวลาที่ต้องการตื่น' : 'เวลาที่จะเริ่มเข้านอน'}
                                    </label>
                                    <div className="relative inline-block group">
                                        <input 
                                            type="time" 
                                            value={inputTime}
                                            onChange={(e) => setInputTime(e.target.value)}
                                            className="bg-transparent text-6xl font-bold text-slate-100 text-center border-none outline-none w-full font-mono relative z-10 focus:scale-105 smooth-transition drop-shadow-2xl"
                                        />
                                        {/* Underline decorative */}
                                        <div className="h-1 w-2/3 mx-auto bg-gradient-to-r from-transparent via-indigo-500 to-transparent opacity-50 group-hover:opacity-100 smooth-transition mt-2 rounded-full"></div>
                                    </div>
                                </div>

                                {/* Main Action Button */}
                                <button 
                                    onClick={calculateTimes}
                                    className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-semibold py-4 rounded-2xl shadow-lg shadow-indigo-500/20 transform active:scale-95 smooth-transition flex items-center justify-center gap-2 text-lg group"
                                >
                                    <span>คำนวณเวลา</span>
                                    <span className="group-hover:translate-x-1 transition-transform">→</span>
                                </button>
                                
                                {mode === 'bedtime' && (
                                    <p className="text-center text-xs text-slate-500 mt-4 animate-pulse">
                                        +15 นาที (เวลาเฉลี่ยจนกว่าจะหลับ)
                                    </p>
                                )}
                            </div>

                            {/* Results View */}
                            <div className={`absolute inset-0 w-full transition-all duration-500 ease-in-out transform 
                                ${view === 'results' ? 'opacity-100 translate-x-0' : 'opacity-0 translate-x-full pointer-events-none'}`}>
                                
                                <div className="text-center mb-6">
                                    <p className="text-slate-300 text-sm font-light">
                                        {mode === 'bedtime' ? 'ควรตั้งนาฬิกาปลุกเวลา' : 'ควรเข้านอนเวลา'}
                                    </p>
                                </div>

                                <div className="space-y-3 max-h-[320px] overflow-y-auto no-scrollbar pb-2 px-1">
                                    {results.map((item, index) => {
                                        const isBest = item.cycles === 5 || item.cycles === 6;
                                        const isGood = item.cycles === 4;
                                        // Staggered animation delay based on index
                                        const delayStyle = { transitionDelay: `${index * 50}ms` };
                                        
                                        return (
                                            <div 
                                                key={`${animateKey}-${index}`}
                                                style={delayStyle}
                                                className={`flex items-center justify-between p-4 rounded-2xl border smooth-transition transform
                                                    ${view === 'results' ? 'translate-y-0 opacity-100' : 'translate-y-4 opacity-0'}
                                                    ${isBest ? 'bg-indigo-500/20 border-indigo-500/40 shadow-lg shadow-indigo-500/10' : 
                                                      isGood ? 'bg-slate-700/30 border-slate-600/30' : 'bg-slate-800/20 border-slate-700/20 opacity-60'}
                                                `}
                                            >
                                                <div className="flex items-baseline gap-3">
                                                    <span className={`text-2xl font-bold font-mono tracking-wider ${isBest ? 'text-indigo-200' : 'text-slate-300'}`}>
                                                        {item.time}
                                                    </span>
                                                    <span className="text-xs text-slate-400">
                                                        {item.cycles} รอบ
                                                    </span>
                                                </div>
                                                
                                                {isBest && (
                                                    <div className="flex items-center gap-1 px-2.5 py-1 bg-indigo-500/20 rounded-lg border border-indigo-500/30">
                                                        <span className="w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse"></span>
                                                        <span className="text-[10px] text-indigo-200 font-medium">แนะนำ</span>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>

                                <button 
                                    onClick={reset}
                                    className="absolute bottom-0 left-0 right-0 w-full mt-4 bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium py-3 rounded-xl smooth-transition flex items-center justify-center gap-2 group border border-slate-700"
                                >
                                    <ChevronLeft className="group-hover:-translate-x-1 transition-transform" size={18} />
                                    <span>คำนวณใหม่</span>
                                </button>
                            </div>

                        </div>

                    </div>
                    
                    {/* Footer / Offline Status */}
                    <div className="mt-8 text-center transition-opacity duration-500">
                        {isOffline ? (
                            <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-yellow-500/10 text-yellow-500 text-xs border border-yellow-500/20">
                                <span className="w-1.5 h-1.5 rounded-full bg-yellow-500"></span>
                                Offline Mode
                            </span>
                        ) : (
                            <span className="text-slate-600 text-xs font-light tracking-widest opacity-50">
                                SLEEP WELL • LIVE BETTER
                            </span>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
